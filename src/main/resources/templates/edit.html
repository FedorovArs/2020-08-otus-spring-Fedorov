<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="keywords" th:content="${keywords}"/>
    <title>Edit book</title>
    <style type="text/css">
        body {
            padding: 50px;
        }

        label {
            display: inline-block;
            width: 100px;
        }

        input:read-only {
            background: lightgray;
        }

        .row {
            margin-top: 10px;
        }
    </style>
    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
</head>
<body>

<form id="editForm" method="post" action="edit.html">
    <h1>Book Info:</h1>

    <div class="row">
        <label for="id-input">ID:</label>
        <input id="id-input" type="text" readonly="readonly" value=""/>
    </div>

    <div class="row">
        <label for="book-name">Name:</label>
        <input id="book-name" name="name" type="text" value=""/>
    </div>

    <div class="row">
        <label for="book-author">Author:</label>
        <input id="book-author" name="author" type="text" value=""/>
    </div>

    <div class="row">
        <label for="book-genre">Genre:</label>
        <input id="book-genre" name="genre" type="text" value=""/>
    </div>

    <div class="row">
        <button type="submit">Edit</button>
    </div>
</form>

<script type="text/javascript">
    let url = window.location.href;
    let splitUrl = url.split("/");
    let bookId = splitUrl[splitUrl.length - 1];

    $(function () {
        $.get('/api/books/' + bookId).done(function (book) {
            $('#id-input').val(book.id);
            $('#book-name').val(book.name);
            $('#book-author').val(book.author);
            $('#book-genre').val(book.genre);
        })
    })

    /* прикрепить событие submit к форме */
    $("#editForm").submit(function (event) {

            /* отключение стандартной отправки формы */
            event.preventDefault();

            /* собираем данные с элементов страницы: */
            let $form = $(this),
                name = $form.find('input[name="name"]').val(),
                author = $form.find('input[name="author"]').val(),
                genre = $form.find('input[name="genre"]').val(),
                editUrl = "/api/books/" + bookId

            $.ajax({
                url: editUrl,
                type: 'PUT',
                dataType: 'PUT',
                contentType: 'application/json;charset=UTF-8',
                data: JSON.stringify({name: name, author: author, genre: genre})
            })
                .statusCode({
                    200: function () {
                        $(location).attr("href", '/books');
                    }
                });
        }
    );
</script>

</body>
</html>
